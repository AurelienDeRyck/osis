{% extends "layout.html" %}
{% load staticfiles %}
{% load i18n %}

{% comment "License" %}
* OSIS stands for Open Student Information System. It's an application
* designed to manage the core business of higher education institutions,
* such as universities, faculties, institutes and professional schools.
* The core business involves the administration of students, teachers,
* courses, programs and so on.
*
* Copyright (C) 2015-2016 Universit√© catholique de Louvain (http://www.uclouvain.be)
*
* This program is free software: you can redistribute it and/or modify
* it under the terms of the GNU General Public License as published by
* the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU General Public License for more details.
*
* A copy of this license - GNU General Public License - is available
* at the root of the source code of this program.  If not,
* see http://www.gnu.org/licenses/.
{% endcomment %}
{% block style %}
<link rel="stylesheet" href="{% static 'css/custom.css' %}">
<link rel="stylesheet" href="{% static 'css/dataTables.bootstrap.min.css' %}">
{% endblock %}
{% block breadcrumb %}
<li><a href="{% url 'institution' %}" id="lnk_institution">{% trans 'institution' %}</a></li>
<li><a href="{% url 'mandates' %}" id="lnk_mandates">{% trans 'mandates' %}</a></li>
<li><a href="{% url 'reviewers_list' %}" id="lnk_reviewers_list">{% trans 'reviewers_list' %}</a></li>
<li class="active">{% trans 'add_reviewer' %}</li>
{% endblock %}
{% block content %}
<div class="page-header">
    <h3>{% trans 'assistantship_mandate_renewal' %} {{ year|add:1 }}</h3>
</div>

<div class="panel panel-default">

    <div class="panel-body">
        <form method="POST" action="{% url 'reviewer_add' %}">
        {{ form.non_field_errors }}
 		    {% csrf_token %}
 		    {% for hidden in form.hidden_fields %}
			    {{ hidden }}
		    {% endfor %}

	    <div class="form-group">
		    <div class="row">
			    <div class="col-md-3">
				    <div class="controls"  onChange="print_email();">
				        <label for="txt_person">{% trans 'person' %}</label>
                    </div>
				    <div class="col-md-3">{% trans 'search_by_email' %}
                        <div class="ui-widget"><input id="persons" size="50"></div>
                        {{ form.person }}<font class="error">{{ form.person.errors }}</font>
					    <div id="email_person"></div>
				    </div>
                </div>
			</div>
			<p></p>
		    <div class="row">
			    <div class="col-md-4">
				    <div class="controls">
				        <label for="txt_structure">{% trans 'structure' %}</label>
				        {{ form.structure }}<font class="error">{{ form.structure.errors }}</font>
				    </div>
			    </div>
		    </div><p></p>
		    <div class="row">
			    <div class="col-md-2">
				    <div class="controls">
				        <label for="txt_role">{% trans 'role' %}</label>
				        {{ form.role }}<font class="error">{{ form.role.errors }}</font>
				    </div>
			    </div>
		    </div><p></p>
            <button type="submit" class="btn btn-primary" title="{% trans 'save'%}" id="bt_add_reviewer_save"
            onclick="return confirm('{% trans 'confirm_reviewer_addition' %}')">
            <span class="glyphicon glyphicon-save" aria-hidden="true"></span> {% trans 'save'%}</button>
            <a class="btn btn-default" id="lnk_upload_cancel" href="{% url 'reviewers_list' %}">
            <span class="glyphicon glyphicon-cancel" aria-hidden="true"></span> {% trans 'cancel'%}</a>
        </div>
    </form>
    </div>
</div>
{% endblock %}
{% block script %}
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="/resources/demos/style.css">
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script>

function print_email()
{
	var email = document.getElementById("id_person").value;
	document.getElementById('email_person').innerHTML = email;
}
window.onload = function() {
    $('#id_person').empty();
    Hide();
    print_email();
};

$(function() {


  $("#persons").autocomplete({
	source: "api/get_persons/",
    minLength: 3,
    select: function(event, ui) {
        var person = $('#persons').val();
        var uri = "api/get_person_from_email/" + person;
        $.ajax({ url: uri }).then(function(data)
            {
            var person = data.person_json[0]
            content = "<option value="+person.id+">" + person.last_name
            +", "+person.first_name+" ("+person.email+")</option>";
            $('#id_person').empty();
             $('#id_person').append(content);
            });

    }
  });
});
</script>
{% endblock %}
