{% extends "layout.html" %}
{% load staticfiles %}
{% load i18n %}

{% comment "License" %}
 * OSIS stands for Open Student Information System. It's an application
 * designed to manage the core business of higher education institutions,
 * such as universities, faculties, institutes and professional schools.
 * The core business involves the administration of students, teachers,
 * courses, programs and so on.
 *
 * Copyright (C) 2015-2016 Universit√© catholique de Louvain (http://www.uclouvain.be)
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * A copy of this license - GNU General Public License - is available
 * at the root of the source code of this program.  If not,
 * see http://www.gnu.org/licenses/.
{% endcomment %}

{% block breadcrumb %}
<li><a href="{% url 'catalog' %}" id="lnk_catalog">{% trans 'catalogue' %}</a></li>
<li><a href="{% url 'learning_units' %}" id="lnk_learning_units">{% trans 'learning_units' %}</a></li>
<li class="active">{% trans 'text_label' %}</li>
{% endblock %}

{% block content %}
<div class="page-header">
    <h2>{{ learning_unit_year.acronym }} - {{ learning_unit_year.title }}</h2>
</div>
<div class="panel panel-default">

  <div class="panel-body">
        {% if request.user.is_superuser %}
        <a onclick="add_row({{forloop.counter}});"  id="lnk_text_label_sub_add_1"
            class="btn btn-default pull-right" role="button" style="margin-left: 5px;">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
            {% trans 'addrow'%}
        </a>
        {% endif %}
        {% if request.user.is_superuser %}
        <a href="{% url 'translated_text_label_read_from_entity' 1 %}" id="lnk_text_translated_label"
           class="btn btn-primary pull-right" role="button" style="margin-left: 5px;">
           <span class="glyphicon glyphicon-transfer" aria-hidden="true"></span>
            {% trans 'translate'%}
        </a>
        {% endif %}
    <table class="table table-striped table-hover" id="tabletxtlabel">
      <thead>
        <th>{% trans 'rubrique'%}</th>
        <th style="width:10%">{% trans 'active'%}</th>
        <th style="width:10%">{% trans 'position'%}</th>
        <th style="width:10%">{% trans 'action'%}</th>
      </thead>
      <tbody>
      {% for text_label in text_labels %}
        <tr id="displaylabel_{{forloop.counter}}">
            <td>
                {% if text_label.part_of %}
                &nbsp;&nbsp;&nbsp;&nbsp;
                {% endif %}
                {{ text_label.label }}
            </td>
            <td>
                {% if text_label.published == True %}
                <span class="glyphicon glyphicon-check" aria-hidden="true" style="font-size:1.5em;"></span>
                {% endif %}
            </td>
            <td> {% if text_label.part_of %}
                &nbsp;&nbsp;&nbsp;&nbsp;
                {% endif %}
                {{ text_label.order }}
            </td>
            <td>
                <a onclick="add_row({{forloop.counter}});"  id="lnk_text_label_sub_add_1"
                   class="btn btn-default pull-right" role="button" style="margin-left: 5px;">
                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                </a>
                <a onclick="edit_row({{forloop.counter}});" id="lnk_text_label_edit_1"
                   class="btn btn-default pull-right" role="button">
                    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                </a>
            </td>
        </tr>
        <tr id="editlabel_{{forloop.counter}}" style="display:none">
            <form method="post" action="{% url 'text_lbl_save' entity_id text_label.id %}">
            {% csrf_token %}
            <td>
                <input class="form-control" value="{{ text_label.label | default_if_none:'' }}"
                       name="label" id="txt_label"/><font class="error">{{ form.label.errors }}</font>
            </td>
            <td>
                <input class="form-control" value="{{ text_label.published | default_if_none:'True' }}"
                       name="published" id="txt_published" type="checkbox"><font class="error">{{ form.published.errors }}</font>
            </td>
            <td>
                <input class="form-control" value="{{ text_label.order | default_if_none:'' }}"
                       name="order" id="txt_order" type="number"><font class="error">{{ form.order.errors }}</font>
            </td>
            <td>
                <a onclick="show_row({{forloop.counter}});" id="lnk_text_label_delete_1"
                   class="btn btn-danger pull-right" role="button" style="margin-left: 5px;">
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                </a>
                <button type="submit" class="btn btn-primary pull-right" title="{% trans 'save'%}" id="lnk_text_label_valid_1">
                    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                </button>
            </td>
            </form>
        </tr>
        <tr id="addlabel_{{forloop.counter}}" style="display:none">
            <form method="post" action="{% url 'text_lbl_save_parent' entity_id text_label.id %}">
            {% csrf_token %}
            <td>
                <input class="form-control" name="label" id="txt_label" style="width: 80%;margin-left:30px;"/><font class="error">{{ form.label.errors }}</font>
            </td>
            <td>
                <input class="form-control"
                       name="published" id="txt_published" type="checkbox"><font class="error">{{ form.published.errors }}</font>
            </td>
            <td>
                <input class="form-control"
                       name="order" id="txt_order" type="number"><font class="error">{{ form.order.errors }}</font>
            </td>
            <td>
                <a onclick="show_row({{forloop.counter}});" id="lnk_text_label_delete_1"
                   class="btn btn-danger pull-right" role="button" style="margin-left: 5px;">
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                </a>
                <button type="submit" class="btn btn-primary pull-right" title="{% trans 'save'%}" id="lnk_text_label_valid_1">
                    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                </button>

            </td>
            </form>
        </tr>
      {% endfor %}
        <tr id="addlabel_new" style="display:none">
            <form method="post" action="{% url 'text_lbl_save_new' entity_id %}">
            {% csrf_token %}
            <td>
                <input class="form-control"
                       name="label" id="txt_label" /><font class="error">{{ form.label.errors }}</font>
            </td>
            <td>
                <input class="form-control"
                       name="published" id="txt_published" type="checkbox"><font class="error">{{ form.published.errors }}</font>
            </td>
            <td>
                <input class="form-control" value="1"
                       name="order" id="txt_order" type="number"><font class="error">{{ form.order.errors }}</font>
            </td>
            <td>
                <a onclick="show_row({{forloop.counter}});" id="lnk_text_label_delete_1"
                   class="btn btn-danger  pull-right" role="button" style="margin-left: 5px;">
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                </a>
                <button type="submit" class="btn btn-primary pull-right" title="{% trans 'save'%}" id="lnk_text_label_valid_1">
                    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                </button>
            </td>
            </form>
        </tr>

      </tbody>
    </table>
   </div>

</div>

<script>

    function add_row(id) {
        if(id==null)
        {
            $( "#addlabel_new").show();
            $('html,body').animate({scrollTop: $("#addlabel_new").offset().top},'slow');
        }
        else
        {
            $( "#addlabel_new").hide();
            $( "#editlabel_"+id ).hide();
            $( "#addlabel_"+id ).show();
        }
    }

    function edit_row(id) {
        $( "#addlabel_new").hide();
        $( "#displaylabel_"+id ).hide();
        $( "#addlabel_"+id ).hide();
        $( "#editlabel_"+id ).show();
    }


    function show_row(id) {
        $( "#addlabel_new").hide();
        $( "#displaylabel_"+id ).show();
        $( "#editlabel_"+id ).hide();
        $( "#addlabel_"+id ).hide();
    }

</script>
{% endblock %}