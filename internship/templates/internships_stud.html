{% extends "layout.html" %}
{% load staticfiles %}
{% load i18n %}

{% comment "License" %}
 * OSIS stands for Open Student Information System. It's an application
 * designed to manage the core business of higher education institutions,
 * such as universities, faculties, institutes and professional schools.
 * The core business involves the administration of students, teachers,
 * courses, programs and so on.
 *
 * Copyright (C) 2015-2016 Université catholique de Louvain (http://www.uclouvain.be)
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * A copy of this license - GNU General Public License - is available
 * at the root of the source code of this program.  If not,
 * see http://www.gnu.org/licenses/.
{% endcomment %}

{% block breadcrumb %}
  <li><a href="{% url 'studies' %}">{% trans 'Studies' %}</a></li>
  <li><a href="{% url 'internships_home' %}">{% trans 'internships' %}</a></li>
  <li class="active">{% trans 'all_internships' %}</li>
{% endblock %}
{% block content %}
<script>
  function check(element){
    var x = document.getElementsByName(element.name);
    var check = 0
    for (i = 0; i < x.length; i++) {
      if (x[i].value !=0) {
        if (element.value > 0) {
          if (x[i].value == element.value) {
            check += 1
          }
        }
      }
    }
    if (check > 1) {
      alert("{% trans 'already_internship_preference_speciality' %}")
      element.value = 0
    }
  }
</script>
  <div class="page-header">
    <h2>{% trans 'internships' %}</h2>
  </div>
  <table style="height:100%; width:100%;">
      <thead>
        <tr>
            <th style="text-align:center; width:50%;">{% trans 'organization' %}</th>
        </tr>
      </thead>
      <tbody>
        <form action="{%url 'internships_stud' %}" method="get">
          <tr>
            <td style="text-align:center; width:50%;">
              <select name="organization_sort" onChange="javascript: this.form.submit();">
               <option value="0">{% trans 'choose_a_hospital' %}</option>
               {% for organization in all_organizations %}
                  <option value="{{ organization.name }}"
                  {% if organization.name == organization_sort_value %}selected{% endif %}>
                      {{ organization.reference }} - {{ organization.name }}
                  </option>
               {% endfor %}
              </select>
            </td>
          </tr>
        </form>
      </tbody>
  </table>
  <br/>
  {% trans 'choose_spec_see_record_choice' %}<br/>
  <span class="glyphicon glyphicon-ok" style="color:green"></span> :
  {% trans 'all_ready_4_choice_spec' %}<br/>
  <span class="glyphicon glyphicon-remove" style="color:red"></span> :
  {% trans 'not_4_choice_spec' %}<br/>
  {% if selectable == False %}<h3><b><u>{% trans 'internship_block_moment' %}</u></b></h3>{%endif%}
  <div class="panel panel-default">
    <div class="panel-body">
        <ul class="nav nav-tabs">
          {% for luy in all_speciality %}
            <li><a data-toggle="tab" href="#tab_{{luy.tab}}">{{luy.name}}
              {%if luy.size = 4 %}
                <span class="glyphicon glyphicon-ok" style="color:green"></span>
              {%else%}
                <span class="glyphicon glyphicon-remove" style="color:red"></span>
              {%endif%}</a></li>
          {% endfor %}
            <li><a data-toggle="tab" href="#tab_CHOIX1">{% trans 'Stage au choix 1'%}</a></li>
            <li><a data-toggle="tab" href="#tab_CHOIX2">{% trans 'Stage au choix 2'%}</a></li>
            <li><a data-toggle="tab" href="#tab_CHOIX2">{% trans 'Stage au choix 3'%}</a></li>
            <li><a data-toggle="tab" href="#tab_CHOIX2">{% trans 'Stage au choix 4'%}</a></li>
        </ul>
        <form  method="post" action="{% url 'internships_save' %}" >
        <input type="hidden" name="organization_sort" value="{{ organization.name }}"/>
        {% csrf_token %}
        <div class="tab-content">
          {% for luy in all_speciality %}
          <div id="tab_{{luy.tab}}" class="tab-pane fade in active">
              <div class="panel panel-default">
                <div class="tab-content">
                  <div role="tabpanel" class="tab-pane fade in active" id="profile">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th>{% trans 'organization' %}</th>
                          <th>{% trans 'student_max' %}</th>
                          <th>{% trans 'Nombre de premier choix' %}</th>
                          <th>{% trans 'preference' %}</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for internship in all_internships %}
                        {% if internship.speciality == luy %}
                          <tr>
                            <td>
                              <input type="hidden" name="organization"
                              value="{{ internship.organization.reference }}"/>
                                {{ internship.organization.reference }} - {{ internship.organization }}
                            </td>
                            <td align="center">
                              <input type="hidden" name="speciality"
                              value="{{ internship.speciality.name }}"/>
                              {{ internship.maximum_enrollments }}
                            </td>
                            <td align="center">
                              {{ internship.number_first_choice }}
                            </td>
                            <td>
                              <select name="preference{{luy.tab}}" onchange="check(this)">
                               <option value=0 {% if internship.selectable == False %} disabled {%endif%}>0</option>
                               <option value=1 {% if internship.choice == 1 %} selected{%endif%}
                                                {% if internship.selectable == False %} disabled {%endif%}>
                                 {% trans 'first_choice' %}
                               </option>
                               <option value=2 {% if internship.choice == 2 %} selected{%endif%}
                                                {% if internship.selectable == False %} disabled {%endif%}>
                                 {% trans 'second_choice' %}
                               </option>
                               <option value=3 {% if internship.choice == 3 %} selected{%endif%}
                                                {% if internship.selectable == False %} disabled {%endif%}>
                                 {% trans 'third_choice' %}
                               </option>
                               <option value=4 {% if internship.choice == 4 %} selected{%endif%}
                                                {% if internship.selectable == False %} disabled {%endif%}>
                                 {% trans 'fourth_choice' %}
                               </option>
                              </select>
                            </td>
                          </tr>
                        {% endif %}
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          {%endfor%}
            <div id="tab_CHOIX1" class="tab-pane fade">
              <div class="panel panel-default">
                <div class="tab-content">
                  <div role="tabpanel" class="tab-pane fade in active" id="profile">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th>{% trans 'organization' %}</th>
                          <th>{% trans 'student_max' %}</th>
                          <th>{% trans 'Nombre de premier choix' %}</th>
                          <th>{% trans 'preference' %}</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for internship in all_internships %}
                        {% if internship.speciality.name = "Stage au choix"%}
                          <tr>
                            <td>
                              <input type="hidden" name="organization"
                              value="{{ internship.organization.reference }}"/>
                                {{ internship.organization.reference }} - {{ internship.organization }}
                            </td>
                            <td align="center">
                              <input type="hidden" name="speciality"
                              value="{{ internship.speciality.name }}"/>
                              {{ internship.maximum_enrollments }}
                            </td>
                            <td align="center">
                              {{ internship.number_first_choice }}
                            </td>
                            <td>
                              <select name="preference">
                               <option value=0 {% if internship.selectable == False %} disabled {%endif%}>0</option>
                               <option value=1 {% if internship.choice == 1 %} selected{%endif%}
                                                {% if internship.selectable == False %} disabled {%endif%}>
                                 Choix préféré
                               </option>
                               <option value=2 {% if internship.choice == 2 %} selected{%endif%}
                                                {% if internship.selectable == False %} disabled {%endif%}>
                                 2ème choix
                               </option>
                               <option value=3 {% if internship.choice == 3 %} selected{%endif%}
                                                {% if internship.selectable == False %} disabled {%endif%}>
                                 3ème choix
                               </option>
                               <option value=4 {% if internship.choice == 4 %} selected{%endif%}
                                                {% if internship.selectable == False %} disabled {%endif%}>
                                 4ème choix
                               </option>
                              </select>
                            </td>
                          </tr>
                        {% endif %}
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <div id="tab_CHOIX2" class="tab-pane fade">
              <div class="panel panel-default">
              <div class="tab-content">
                  <div role="tabpanel" class="tab-pane fade in active" id="profile">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th>{% trans 'organization' %}</th>
                          <th>{% trans 'student_max' %}</th>
                          <th>{% trans 'Nombre de 1er choix' %}</th>
                          <th>{% trans 'preference' %}</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for internship in all_internships %}
                        {% if internship.speciality.name = "Stage au choix"%}
                          <tr>
                            <td>
                              <input type="hidden" name="organization"
                              value="{{ internship.organization.reference }}"/>
                                {{ internship.organization.reference }} - {{ internship.organization }}
                            </td>
                            <td align="center">
                              <input type="hidden" name="speciality"
                              value="{{ internship.speciality.name }}"/>
                              {{ internship.maximum_enrollments }}
                            </td>
                            <td align="center">
                              {{ internship.number_first_choice }}
                            </td>
                            <td>
                              <select name="preference">
                               <option value=0 {% if internship.selectable == False %} disabled {%endif%}>0</option>
                               <option value=1 {% if internship.choice == 1 %} selected{%endif%}
                                                {% if internship.selectable == False %} disabled {%endif%}>
                                 Choix préféré
                               </option>
                               <option value=2 {% if internship.choice == 2 %} selected{%endif%}
                                                {% if internship.selectable == False %} disabled {%endif%}>
                                 2ème choix
                               </option>
                               <option value=3 {% if internship.choice == 3 %} selected{%endif%}
                                                {% if internship.selectable == False %} disabled {%endif%}>
                                 3ème choix
                               </option>
                               <option value=4 {% if internship.choice == 4 %} selected{%endif%}
                                                {% if internship.selectable == False %} disabled {%endif%}>
                                 4ème choix
                               </option>
                              </select>
                            </td>
                          </tr>
                        {% endif %}
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% if selectable == True %}
            <button type="submit" class="btn btn-primary" title="{% trans 'submission' %}" id="bt_interships_save">
                <span class="glyphicon glyphicon-save" aria-hidden="true"></span> {% trans 'submission' %}
            </button>
          {%endif%}
        </div>
        </form>
  </div>
{% endblock %}
