{% extends "layout.html" %}
{% load percentage %}

{% comment "License" %}
   OSIS stands for Open Student Information System. It's an application
   designed to manage the core business of higher education institutions,
   such as universities, faculties, institutes and professional schools.
   The core business involves the administration of students, teachers,
   courses, programs and so on.

   Copyright (C) 2015-2016 Université catholique de Louvain (http://www.uclouvain.be)

   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   A copy of this license - GNU General Public License - is available
   at the root of the source code of this program.  If not,
   see http://www.gnu.org/licenses/.
{% endcomment %}

{% block breadcrumb %}
  <li><a href="{% url 'studies' %}">Les études</a></li>
  <li><a href="{% url 'assessements' %}">Évaluations</a></li>
  <li><a href="{% url 'scores_encoding' %}">Encodage des notes</a></li>
  <li class="active">Encodage en ligne</li>
{% endblock %}
{% block content %}
  <div class="page-header">
    <h2>Encodage en ligne</h2>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title" style="font-size: 150%; color: #3399CC;">{{ session.learning_unit_year }}</h3>
    </div>
    <div class="panel-body">
      <div class="row">
        <div class="col-md-4">
          <div class="form-group">
            <label>Responsable</label><br>
            {{ tutor }}
          </div>
        </div>
        <div class="col-md-2">
          <div class="form-group">
            <label>Année académique</label><br>
            {{ academic_year }}
          </div>
        </div>
        <div class="col-md-2">
          <div class="form-group">
            <label>Session</label><br>
            {{ session.number_session }}
          </div>
        </div>
        <div class="col-md-2">
          <div class="form-group">
            <label>Nombre d'inscrits</label><br>
            {{ enrollments|length }}
          </div>
        </div>
        <div class="col-md-2">
          <div class="form-group">
            <label>Progrès</label><br>
            {{ progress | percentage }}
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label>Programme</label><br>
            <select class="form-control">
              <option value="volvo">Tous</option>
            </select>
          </div>
        </div>
        <div class="col-md-6"></div>
      </div>

      <br><a class="btn btn-default" href="{% url 'online_encoding_form' session.id %}" role="button"><i class="fa fa-hashtag"></i> Encoder</a></p>
      <table class="table table-hover">
          <thead>
            <th>Programme</th>
            <th>Noma</th>
            <th>Nom</th>
            <th>Prénom</th>
            <th>Note</th>
            <th>Justification</th>
            <th>Date de remise</th>
          </thead>
          <tbody>
          {% for enrollment in enrollments %}
            <tr>
              <td>{{ enrollment.learning_unit_enrollment.offer_enrollment.offer_year.acronym }}</td>
              <td>{{ enrollment.learning_unit_enrollment.offer_enrollment.student.registration_id }}</td>
              <td>{{ enrollment.learning_unit_enrollment.offer_enrollment.student.person.last_name }}</td>
              <td>{{ enrollment.learning_unit_enrollment.offer_enrollment.student.person.first_name }}</td>
              <td>{{ enrollment.score | default_if_none:"-" }}</td>
              <td>{{ enrollment.justification | default_if_none:"-" }}</td>
              <td>{{ enrollment.session_exam.offer_year_calendar.end_date }}</td>
            </tr>
          {% endfor %}
          </tbody>
      </table>
      {% if messages %}
      <ul class="messages">
          {% for message in messages %}
          <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
          {% endfor %}
      </ul>
      {% endif %}

      {% if encoding_type == '2' %}
        <button type="button" class="btn btn-default" data-toggle="modal" data-target="#uploadScoreModal" title="Permet de sélectionner le fichier excel contenant les notes à téléverser">Téléverser</button>
        <br/>
      {% endif%}
    </div>
  </div>
  <!-- UploadFile modal -->
  <div class="modal fade" id="uploadScoreModal" tabindex="-1" role="dialog" aria-labelledby="uploadScroresLabel">
      <div class="modal-dialog" role="document">
          <div class="modal-content">
              <form method="post" enctype="multipart/form-data" action="{% url 'upload_encoding' session.id session.learning_unit_year.id academic_year.id%}">
                  {% csrf_token %}
              <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                  <h4 class="modal-title" id="uploadScroresLabel">Téléchargement des notes</h4>
              </div>
              <div class="modal-body">
                  <input type="file" id="scoresInputFile" id="file" name="file"/>
                  <p class="help-block">Veuillez sélectionner le fichier excel à télécharger</p>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
                  <input type="submit" class="btn btn-primary" value="Charger"/>
              </div>
              </form>
          </div>
      </div>
  </div>
{% endblock %}
